<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BPMN Viewer - 一键生成图标</title>
  <style>
    body {
      font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
      color: #333;
      background-color: #f9f9f9;
    }
    h1 {
      color: #2980b9;
      text-align: center;
      margin-bottom: 30px;
    }
    .container {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      padding: 25px;
      margin-bottom: 20px;
    }
    .icon-preview {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }
    .icon-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      background-color: #f5f7fa;
      border-radius: 6px;
      padding: 15px;
      transition: transform 0.2s;
    }
    .icon-item:hover {
      transform: translateY(-3px);
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }
    .icon-canvas {
      border: 1px dashed #ddd;
      margin-bottom: 10px;
      background-color: white;
    }
    .size-label {
      font-size: 14px;
      color: #666;
    }
    .button {
      display: block;
      width: 100%;
      padding: 12px;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.2s;
      margin: 10px 0;
      text-align: center;
    }
    .button:hover {
      background-color: #2980b9;
    }
    .msg {
      text-align: center;
      margin: 20px 0;
      padding: 10px;
      border-radius: 4px;
      display: none;
    }
    .success {
      background-color: #d4edda;
      color: #155724;
    }
    footer {
      text-align: center;
      margin-top: 30px;
      font-size: 12px;
      color: #777;
    }
  </style>
</head>
<body>
  <h1>BPMN Viewer 图标生成器</h1>
  
  <div class="container">
    <div class="icon-preview">
      <div class="icon-item">
        <canvas id="canvas16" width="16" height="16" class="icon-canvas"></canvas>
        <span class="size-label">16×16</span>
      </div>
      <div class="icon-item">
        <canvas id="canvas32" width="32" height="32" class="icon-canvas"></canvas>
        <span class="size-label">32×32</span>
      </div>
      <div class="icon-item">
        <canvas id="canvas48" width="48" height="48" class="icon-canvas"></canvas>
        <span class="size-label">48×48</span>
      </div>
      <div class="icon-item">
        <canvas id="canvas128" width="128" height="128" class="icon-canvas"></canvas>
        <span class="size-label">128×128</span>
      </div>
    </div>
    
    <button id="downloadAllBtn" class="button">一键生成并下载所有图标</button>
    
    <div id="successMsg" class="msg success">
      所有图标已下载成功！请将图标文件放到icons文件夹中
    </div>
  </div>

  <script>
    const svgData = `<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg width="128" height="128" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg">
  <!-- 背景 -->
  <defs>
    <linearGradient id="bgGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" stop-color="#3498db" />
      <stop offset="100%" stop-color="#2980b9" />
    </linearGradient>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feGaussianBlur stdDeviation="2" result="blur" />
      <feColorMatrix in="blur" type="matrix" values="0 0 0 0 0  0 0 0 0 0  0 0 0 0 0  0 0 0 0.3 0" result="shadow" />
      <feOffset in="shadow" dx="2" dy="2" result="shadow" />
      <feBlend in="SourceGraphic" in2="shadow" mode="normal" />
    </filter>
  </defs>
  
  <!-- 主背景圆形 -->
  <circle cx="64" cy="64" r="60" fill="url(#bgGradient)" />
  
  <!-- BPMN元素 - 简洁现代设计 -->
  <g transform="translate(64,64)" filter="url(#shadow)">
    <!-- 文档基础 -->
    <rect x="-35" y="-40" width="70" height="80" rx="4" ry="4" fill="white" stroke="#2c3e50" stroke-width="1.5" />
    
    <!-- 流程元素 -->
    <circle cx="-15" cy="-20" r="8" fill="#ecf0f1" stroke="#2c3e50" stroke-width="1.5" />
    <rect x="5" y="-25" width="20" height="14" rx="2" ry="2" fill="#ecf0f1" stroke="#2c3e50" stroke-width="1.5" />
    <rect x="-23" y="0" width="14" height="14" transform="rotate(45, -16, 7)" fill="#ecf0f1" stroke="#2c3e50" stroke-width="1.5" />
    <circle cx="15" cy="15" r="8" fill="#ecf0f1" stroke="#2c3e50" stroke-width="1.5" />
    <circle cx="15" cy="15" r="5" fill="#2c3e50" />
    
    <!-- 连接线 -->
    <path d="M-7,-20 L5,-18 M25,-18 L15,7 M-10,7 L7,15" stroke="#2c3e50" stroke-width="1.5" fill="none" />
    
    <!-- 顶部文档标题线 -->
    <line x1="-25" y1="-30" x2="25" y2="-30" stroke="#3498db" stroke-width="2" />
  </g>
</svg>`;
    
    const sizes = [16, 32, 48, 128];
    
    // 渲染SVG到Canvas
    function renderSVGToCanvas(svg, canvas) {
      return new Promise((resolve, reject) => {
        const ctx = canvas.getContext('2d');
        const img = new Image();
        const blob = new Blob([svg], {type: 'image/svg+xml'});
        const url = URL.createObjectURL(blob);
        
        img.onload = () => {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
          URL.revokeObjectURL(url);
          resolve();
        };
        
        img.onerror = reject;
        img.src = url;
      });
    }
    
    // 下载Canvas为PNG
    function downloadCanvas(canvas, filename) {
      return new Promise(resolve => {
        const link = document.createElement('a');
        link.download = filename;
        link.href = canvas.toDataURL('image/png');
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        setTimeout(resolve, 300); // 小延迟，让下载有时间启动
      });
    }
    
    // 下载所有图标
    async function downloadAllIcons() {
      const downloadBtn = document.getElementById('downloadAllBtn');
      downloadBtn.disabled = true;
      downloadBtn.textContent = '正在生成图标...';
      
      try {
        // 先生成所有图标预览
        for (const size of sizes) {
          const canvas = document.getElementById(`canvas${size}`);
          await renderSVGToCanvas(svgData, canvas);
        }
        
        // 下载所有图标
        for (const size of sizes) {
          const canvas = document.getElementById(`canvas${size}`);
          await downloadCanvas(canvas, `icon${size}.png`);
        }
        
        // 显示成功消息
        document.getElementById('successMsg').style.display = 'block';
      } catch (error) {
        console.error('图标生成失败:', error);
        alert('生成图标时出现错误，请重试');
      } finally {
        downloadBtn.disabled = false;
        downloadBtn.textContent = '一键生成并下载所有图标';
      }
    }
    
    // 初始化
    document.addEventListener('DOMContentLoaded', () => {
      // 绑定下载按钮
      document.getElementById('downloadAllBtn').addEventListener('click', downloadAllIcons);
      
      // 显示图标预览
      sizes.forEach(size => {
        renderSVGToCanvas(svgData, document.getElementById(`canvas${size}`));
      });
    });
  </script>
  
  <footer>
    BPMN Viewer - 提供便捷的BPMN流程图查看体验
  </footer>
</body>
</html> 